<!DOCTYPE html>
<html lang=en>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>JVM之GC垃圾回收器浅析 | 叫我021吧</title>
  <meta name="description" content="JVM之GC垃圾回收器浅析Wirte by 021.   Leave a message if i messed up ! : )  对象头 GC垃圾回收器的目标 减少GC停顿时间 避免程序崩溃 优化JVM内存空间  GC垃圾回收的主要步骤：A garbage collector (GC) is a memory management tool. The G1 GC achieves automa">
<meta property="og:type" content="article">
<meta property="og:title" content="JVM之GC垃圾回收器浅析">
<meta property="og:url" content="http://www.010101.cc/2021/11/11/JVM%E4%B9%8BGC%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E5%88%86%E6%9E%90/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="JVM之GC垃圾回收器浅析Wirte by 021.   Leave a message if i messed up ! : )  对象头 GC垃圾回收器的目标 减少GC停顿时间 避免程序崩溃 优化JVM内存空间  GC垃圾回收的主要步骤：A garbage collector (GC) is a memory management tool. The G1 GC achieves automa">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gwqlquf8qmj30kc0hmwg7.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gwcd4ba2k2j30k006yjrz.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gwqgycbj9tj31400u00xj.jpg">
<meta property="article:published_time" content="2021-11-11T07:04:04.000Z">
<meta property="article:modified_time" content="2021-11-25T03:20:06.674Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="JVM">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tva1.sinaimg.cn/large/008i3skNgy1gwqlquf8qmj30kc0hmwg7.jpg">
  <!-- Canonical links -->
  <link rel="canonical" href="http://www.010101.cc/2021/11/11/JVM%E4%B9%8BGC%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E5%88%86%E6%9E%90/index.html">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="main-center theme-blue" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/with021" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">010101 Decimal is 21, so call me 021(zero to one)</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">Web Developer</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav ">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">Home</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">Archives</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">Categories</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">Tags</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/./links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">Links</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/./about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">About</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/with021" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://weibo.com/with021" target="_blank" title="Weibo" data-toggle=tooltip data-placement=top><i class="icon icon-weibo"></i></a></li>
        
        <li><a href="https://twitter.com/with021" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">Board</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>欢迎与我交流和分享经验!</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">Categories</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Assembly/">Assembly</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/C%E8%AF%AD%E8%A8%80/">C语言</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/">Redis</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/">内存管理</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/">工具使用</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%86%85%E6%A0%B8/">操作系统内核</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/">数据结构与算法</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B5%8B%E8%AF%95%E5%88%86%E7%B1%BB/">测试分类</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6/">计算机硬件</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tags</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C++</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C%E8%AF%AD%E8%A8%80/" rel="tag">C语言</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/" rel="tag">JVM</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PE%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6/" rel="tag">PE可执行文件</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/" rel="tag">工具使用</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E9%97%AE%E9%A2%98/" rel="tag">工具使用问题</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/" rel="tag">常见问题解决</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B9%B6%E5%8F%91%E5%8E%9F%E5%AD%90%E9%94%81/" rel="tag">并发原子锁</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%86%85%E6%A0%B8/" rel="tag">操作系统内核</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A0%91%E7%BB%93%E6%9E%84/" rel="tag">树结构</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B1%87%E7%BC%96/" rel="tag">汇编</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%8B%E8%AF%95%E6%A0%87%E7%AD%BE/" rel="tag">测试标签</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84/" rel="tag">线性结构</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BF%9B%E7%A8%8B-%E7%BA%BF%E7%A8%8B/" rel="tag">进程&线程</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%A1%B5/" rel="tag">页</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%AB%98%E5%B9%B6%E5%8F%91%E5%8E%9F%E5%AD%90%E9%94%81/" rel="tag">高并发原子锁</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/C/" style="font-size: 13px;">C++</a> <a href="/tags/C%E8%AF%AD%E8%A8%80/" style="font-size: 13.33px;">C语言</a> <a href="/tags/JVM/" style="font-size: 14px;">JVM</a> <a href="/tags/PE%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6/" style="font-size: 13px;">PE可执行文件</a> <a href="/tags/Redis/" style="font-size: 13px;">Redis</a> <a href="/tags/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/" style="font-size: 13px;">工具使用</a> <a href="/tags/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E9%97%AE%E9%A2%98/" style="font-size: 13px;">工具使用问题</a> <a href="/tags/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/" style="font-size: 13px;">常见问题解决</a> <a href="/tags/%E5%B9%B6%E5%8F%91%E5%8E%9F%E5%AD%90%E9%94%81/" style="font-size: 13.33px;">并发原子锁</a> <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%86%85%E6%A0%B8/" style="font-size: 13px;">操作系统内核</a> <a href="/tags/%E6%A0%91%E7%BB%93%E6%9E%84/" style="font-size: 13px;">树结构</a> <a href="/tags/%E6%B1%87%E7%BC%96/" style="font-size: 13.33px;">汇编</a> <a href="/tags/%E6%B5%8B%E8%AF%95%E6%A0%87%E7%AD%BE/" style="font-size: 13px;">测试标签</a> <a href="/tags/%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84/" style="font-size: 13px;">线性结构</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 13px;">设计模式</a> <a href="/tags/%E8%BF%9B%E7%A8%8B-%E7%BA%BF%E7%A8%8B/" style="font-size: 13.67px;">进程&线程</a> <a href="/tags/%E9%A1%B5/" style="font-size: 13px;">页</a> <a href="/tags/%E9%AB%98%E5%B9%B6%E5%8F%91%E5%8E%9F%E5%AD%90%E9%94%81/" style="font-size: 13px;">高并发原子锁</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">Archive</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a><span class="archive-list-count">30</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Redis/">Redis</a>
              </p>
              <p class="item-title">
                <a href="/2021/11/26/%E7%A7%92%E6%9D%80%E7%9A%84%E6%9C%AC%E8%B4%A8/" class="title">高并发之Redis秒杀的本质</a>
              </p>
              <p class="item-date">
                <time datetime="2021-11-26T11:28:30.000Z" itemprop="datePublished">2021-11-26</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/">工具使用</a>
              </p>
              <p class="item-title">
                <a href="/2021/11/20/MBP%E6%97%A5%E5%B8%B8%E4%BD%BF%E7%94%A8%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/" class="title">MacBook Pro intel日常使用问题记录</a>
              </p>
              <p class="item-date">
                <time datetime="2021-11-19T19:12:21.000Z" itemprop="datePublished">2021-11-20</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/C%E8%AF%AD%E8%A8%80/">C语言</a>
              </p>
              <p class="item-title">
                <a href="/2021/11/20/C%E8%AF%AD%E8%A8%80%E4%B9%8B%E9%BA%BB%E8%BE%A3%E9%A6%99%E9%94%85/" class="title">C语言基础之麻辣香锅</a>
              </p>
              <p class="item-date">
                <time datetime="2021-11-19T19:08:02.000Z" itemprop="datePublished">2021-11-20</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/C%E8%AF%AD%E8%A8%80/">C语言</a>
              </p>
              <p class="item-title">
                <a href="/2021/11/20/C++%E7%9A%84%E8%8A%B1%E6%8B%B3%E7%BB%A3%E8%85%BF/" class="title">Kill someone who wirting C++&amp;Java!</a>
              </p>
              <p class="item-date">
                <time datetime="2021-11-19T19:08:02.000Z" itemprop="datePublished">2021-11-20</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%86%85%E6%A0%B8/">操作系统内核</a>
              </p>
              <p class="item-title">
                <a href="/2021/11/17/epoll%E4%B9%8Bredis%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B/" class="title">epoll之redis自顶向下</a>
              </p>
              <p class="item-date">
                <time datetime="2021-11-17T04:16:39.000Z" itemprop="datePublished">2021-11-17</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">Catalogue</h3>
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#JVM%E4%B9%8BGC%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E6%B5%85%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">JVM之GC垃圾回收器浅析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E5%A4%B4"><span class="toc-number">1.0.1.</span> <span class="toc-text">对象头</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GC%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E7%9A%84%E7%9B%AE%E6%A0%87"><span class="toc-number">1.0.2.</span> <span class="toc-text">GC垃圾回收器的目标</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GC%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%9A%84%E4%B8%BB%E8%A6%81%E6%AD%A5%E9%AA%A4%EF%BC%9A"><span class="toc-number">1.0.3.</span> <span class="toc-text">GC垃圾回收的主要步骤：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CMS"><span class="toc-number">1.1.</span> <span class="toc-text">CMS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#G1-%EF%BC%88garbage-first-%E5%9E%83%E5%9C%BE%E7%AC%AC%E4%B8%80%EF%BC%89"><span class="toc-number">1.2.</span> <span class="toc-text">G1 （garbage first 垃圾第一）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%98%E6%96%B9%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.2.1.</span> <span class="toc-text">官方介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E6%80%A7"><span class="toc-number">1.2.2.</span> <span class="toc-text">特性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Phases-of-the-Marking-Cycle-%E6%A0%87%E8%AE%B0%E5%91%A8%E6%9C%9F%E7%9A%84%E9%98%B6%E6%AE%B5%E6%80%A7"><span class="toc-number">1.2.3.</span> <span class="toc-text">Phases of the Marking Cycle(标记周期的阶段性)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Garbage-Collection-Phases-%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E9%98%B6%E6%AE%B5"><span class="toc-number">1.2.4.</span> <span class="toc-text">Garbage Collection Phases(垃圾收集阶段)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Young-Garbage-Collections%EF%BC%88%E5%B9%B4%E8%BD%BB%E4%BB%A3%E7%9A%84%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%EF%BC%89"><span class="toc-number">1.2.5.</span> <span class="toc-text">Young Garbage Collections（年轻代的垃圾收集）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mixed-Garbage-Collections-%EF%BC%88%E6%B7%B7%E5%90%88%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%EF%BC%89"><span class="toc-number">1.2.6.</span> <span class="toc-text">Mixed Garbage Collections （混合垃圾收集）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Important-Defaults-%EF%BC%88%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%EF%BC%89"><span class="toc-number">1.2.7.</span> <span class="toc-text">Important Defaults （官方文档）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#How-to-Unlock-Experimental-VM-Flags"><span class="toc-number">1.2.8.</span> <span class="toc-text">How to Unlock Experimental VM Flags</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Recommendations"><span class="toc-number">1.2.9.</span> <span class="toc-text">Recommendations</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Overflow-and-Exhausted-Log-Messages"><span class="toc-number">1.2.10.</span> <span class="toc-text">Overflow and Exhausted Log Messages</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Humongous-Objects-and-Humongous-Allocations"><span class="toc-number">1.2.11.</span> <span class="toc-text">Humongous Objects and Humongous Allocations</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Conclusion"><span class="toc-number">1.2.12.</span> <span class="toc-text">Conclusion</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#See-Also"><span class="toc-number">1.2.13.</span> <span class="toc-text">See Also</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#About-the-Author"><span class="toc-number">1.2.14.</span> <span class="toc-text">About the Author</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%8B%E8%80%85ZGC"><span class="toc-number">1.3.</span> <span class="toc-text">王者ZGC</span></a></li></ol></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-JVM之GC垃圾回收器分析" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      JVM之GC垃圾回收器浅析
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2021/11/11/JVM%E4%B9%8BGC%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E5%88%86%E6%9E%90/" class="article-date">
	  <time datetime="2021-11-11T07:04:04.000Z" itemprop="datePublished">2021-11-11</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/JVM/" rel="tag">JVM</a>
  </span>


        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill" aria-hidden="true"></i>
	    <span id="busuanzi_container_page_pv">
			<span id="busuanzi_value_page_pv">0</span>
		</span>
	</span>


        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/11/11/JVM%E4%B9%8BGC%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E5%88%86%E6%9E%90/#comments" class="article-comment-link">Comments</a></span>
        
      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h2 id="JVM之GC垃圾回收器浅析"><a href="#JVM之GC垃圾回收器浅析" class="headerlink" title="JVM之GC垃圾回收器浅析"></a>JVM之GC垃圾回收器浅析</h2><p>Wirte by 021.   Leave a message if i messed up ! : )</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gwqlquf8qmj30kc0hmwg7.jpg" alt="img"></p>
<h4 id="对象头"><a href="#对象头" class="headerlink" title="对象头"></a>对象头</h4><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gwcd4ba2k2j30k006yjrz.jpg" alt="img"></p>
<h4 id="GC垃圾回收器的目标"><a href="#GC垃圾回收器的目标" class="headerlink" title="GC垃圾回收器的目标"></a>GC垃圾回收器的目标</h4><ul>
<li><strong>减少GC停顿时间</strong></li>
<li><strong>避免程序崩溃</strong></li>
<li><strong>优化JVM内存空间</strong></li>
</ul>
<h4 id="GC垃圾回收的主要步骤："><a href="#GC垃圾回收的主要步骤：" class="headerlink" title="GC垃圾回收的主要步骤："></a>GC垃圾回收的主要步骤：</h4><p>A garbage collector (GC) is a memory management tool. The G1 GC achieves automatic memory management through the following operations:</p>
<ul>
<li><p>Allocating objects to a young generation and promoting aged objects into an old generation.</p>
<ul>
<li><strong>在年轻代为新的对象分配内存, 将晋升的对象移到老年代</strong></li>
</ul>
</li>
<li><p>Finding live objects in the old generation through a concurrent (parallel) marking phase. The Java HotSpot VM triggers the marking phase when the total Java heap occupancy exceeds the default threshold.</p>
<ul>
<li><strong>通过并发(并行)标记阶段在老年代寻找存活对象，当Java的堆总内存占用率超过默认的阈值时hotspop虚拟机将触发标记执行阶段</strong></li>
</ul>
</li>
<li><p>Recovering free memory by compacting live objects through parallel copying.</p>
<ul>
<li><strong>通过并行的 ”复制和压缩存活对象“ 的方式，来恢复和释放可用的内存空间</strong></li>
</ul>
</li>
</ul>
<h3 id="CMS"><a href="#CMS" class="headerlink" title="CMS"></a>CMS</h3><ul>
<li><strong>基于 标记-清除 算法</strong></li>
<li><strong>适用于老年代</strong></li>
</ul>
<ul>
<li><p><strong>回收过程</strong></p>
<ul>
<li><strong>初始标记 STW</strong></li>
<li><strong>并发标记</strong></li>
<li><strong>重新标记 STW</strong></li>
<li><strong>并发清除</strong></li>
</ul>
</li>
<li><p><strong>缺陷</strong></p>
<ul>
<li><p><strong>2次STW</strong></p>
</li>
<li><p><strong>内存碎片化</strong></p>
</li>
</ul>
</li>
</ul>
<h3 id="G1-（garbage-first-垃圾第一）"><a href="#G1-（garbage-first-垃圾第一）" class="headerlink" title="G1 （garbage first 垃圾第一）"></a>G1 （garbage first 垃圾第一）</h3><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gwqgycbj9tj31400u00xj.jpg" alt="Untitled 3"></p>
<ul>
<li><p><strong>逻辑分代对象</strong></p>
<ul>
<li><p><strong>eden 新创建的对象（new object）</strong></p>
</li>
<li><p><strong>survivor 存活对象</strong></p>
</li>
<li><p><strong>old 老年对象</strong></p>
</li>
<li><p><strong>humongous 超大对象</strong></p>
</li>
</ul>
</li>
</ul>
<h4 id="官方介绍"><a href="#官方介绍" class="headerlink" title="官方介绍"></a>官方介绍</h4><ul>
<li>The <a target="_blank" rel="noopener" href="https://www.oracle.com/java/technologies/javase/hotspot-garbage-collection.html">Garbage First Garbage Collector (G1 GC)</a> is the low-pause, server-style generational garbage collector for Java HotSpot VM. The G1 GC uses concurrent and parallel phases to achieve its target pause time and to maintain good throughput. When G1 GC determines that a garbage collection is necessary, it collects the regions with the least live data first (garbage first).</li>
</ul>
<h4 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h4><ul>
<li><strong>it collects the regions with the least live data first</strong><ul>
<li><strong>优先收集存活对最少的区域</strong></li>
</ul>
</li>
</ul>
<ul>
<li><p><strong>The G1 GC is a regionalized and generational garbage collector, which means that the Java object heap (heap) is divided into a number of equally sized regions. Upon startup, the Java Virtual Machine (JVM) sets the region size. The region sizes can vary from 1 MB to 32 MB depending on the heap size. The goal is to have no more than 2048 regions. The eden, survivor, and old generations are logical sets of these regions and are not contiguous.</strong></p>
<ul>
<li><strong>G1是区域化和分代的垃圾回收器，堆内存被划分化为大小相等的区域。启动时，虚拟机会设置区域大小。这些区域的大小会根据总堆尺寸被划分为1-32m不同的尺寸。目标是不要超过2048个区域。年轻代，存活代，和老年代，在区域里是逻辑集合，并且并不是连续相邻的.</strong></li>
</ul>
</li>
</ul>
<ul>
<li><p><strong>The G1 GC has a pause time-target that it tries to meet (soft real time). During young collections, the G1 GC adjusts its young generation (eden and survivor sizes) to meet the soft real-time target. During mixed collections, the G1 GC adjusts the number of old regions that are collected based on a target number of mixed garbage collections, the percentage of live objects in each region of the heap, and the overall acceptable heap waste percentage.</strong></p>
<ul>
<li><strong>G1 GC 有一个它试图满足的暂停时间的目标，</strong></li>
<li>**在年轻代收集期间，G1回收器会调整 年轻代的堆尺寸 来达到 ”暂停时间的预期 目标“. **</li>
<li><strong>在混合混合收集期间，G1回收器会调整 收集过的老年代区域的数量， 基于混合收集器模式预期的目标数量，以及在整个堆每个区域中存活对象的比例，和综合可接受的堆浪费比。</strong></li>
</ul>
</li>
</ul>
<h4 id="Phases-of-the-Marking-Cycle-标记周期的阶段性"><a href="#Phases-of-the-Marking-Cycle-标记周期的阶段性" class="headerlink" title="Phases of the Marking Cycle(标记周期的阶段性)"></a>Phases of the Marking Cycle(标记周期的阶段性)</h4><p>The marking cycle has the following phases:</p>
<ul>
<li><p><strong>Initial mark phase</strong>: The G1 GC marks the roots during this phase. This phase is piggybacked on a normal (STW) young garbage collection.</p>
<ul>
<li><strong>初始化标记阶段（STW）： G1 在这个阶段是 从ROOTS开始引用. 这阶段会装载一个普通（STW)的young垃圾回收上。</strong></li>
</ul>
</li>
<li><p><strong>Root region scanning phase</strong>: The G1 GC scans survivor regions of the initial mark for references to the old generation and marks the referenced objects. This phase runs concurrently with the application (not STW) and must complete before the next STW young garbage collection can start.</p>
<ul>
<li><strong>根区块扫描阶段： G1会扫描 在 （初始标记阶段中 成为old老年代的引用和被老年代引用的对象） 中的survivor存活区块 . 这个阶段是并发运行的应用线程不需要停止，只有当前扫描完成后下一个young垃圾收集才能(STW)开始.</strong></li>
</ul>
</li>
<li><p><strong>Concurrent marking phase</strong>: The G1 GC finds reachable (live) objects across the entire heap. This phase happens concurrently with the application, and can be interrupted by STW young garbage collections.</p>
<ul>
<li><strong>并发标记阶段： G1 在整个堆中寻找可达存活的对象.这个阶段与应用线程并发执行，并且可以被young年轻代垃圾收集器(STW)打断.</strong></li>
</ul>
</li>
</ul>
<ul>
<li><p><strong>Remark phase</strong>: This phase is STW collection and helps the completion of the marking cycle. G1 GC drains SATB buffers, traces unvisited live objects, and performs reference processing.</p>
<ul>
<li><strong>重新标记阶段(STW)： 这个阶段是为了帮助其完成标记周期的。G1将会清空SATB(Snapshot-At-The-Beginning)的缓冲区，追踪未访问的存活对象，和执行重新引用进程。</strong></li>
</ul>
</li>
<li><p><strong>Cleanup phase</strong>: In this final phase, the G1 GC performs the STW operations of accounting and RSet scrubbing. During accounting, the G1 GC identifies completely free regions and mixed garbage collection candidates. The cleanup phase is partly concurrent when it resets and returns the empty regions to the free list.</p>
<ul>
<li>**清理阶段（STW）： 在这最后一步，G1 会执行 计算和清理RSET的STW操作. 在计算期间, G1 会分解出 完整的空闲区块 和 混合垃圾收集的和混合收集器待收集的对象。 清理阶段一定程度上是并发的当 重置和返回空区块到空闲清单  的时候。 **</li>
</ul>
</li>
</ul>
<h4 id="Garbage-Collection-Phases-垃圾收集阶段"><a href="#Garbage-Collection-Phases-垃圾收集阶段" class="headerlink" title="Garbage Collection Phases(垃圾收集阶段)"></a>Garbage Collection Phases(垃圾收集阶段)</h4><p>Apart from evacuation pauses (described below) that compose the stop-the-world (STW) young and mixed garbage collections, the G1 GC also has parallel, concurrent, and multiphase marking cycles. G1 GC uses the Snapshot-At-The-Beginning (SATB) algorithm, which takes a snapshot of the set of live objects in the heap at the start of a marking cycle. The set of live objects is composed of the live objects in the snapshot, and the objects allocated since the start of the marking cycle. The G1 GC marking algorithm uses a pre-write barrier to record and mark objects that are part of the logical snapshot.</p>
<ul>
<li><strong>下面的两段分别描述了组成 stop-the-world (STW) 的两种回收器， 年轻代回收器与混合回收器，G1 也具备 并发 ，并行 和 联合多相标记周期. G1 使用快照的算法，在标记周期开始之前取得堆中存活对象集合的快照. 快照中的存活对象集合组成了一个集合，并且在开始标记之前这些对象已经被分配好了.  G1的标记算法用了前置的写屏障来记录和标记对象来保证对象在物理快照中的一致性。</strong></li>
</ul>
<h4 id="Young-Garbage-Collections（年轻代的垃圾收集）"><a href="#Young-Garbage-Collections（年轻代的垃圾收集）" class="headerlink" title="Young Garbage Collections（年轻代的垃圾收集）"></a>Young Garbage Collections（年轻代的垃圾收集）</h4><p>The G1 GC satisfies most allocation requests from regions added to the eden set of regions. During a young garbage collection, the G1 GC collects both the eden regions and the survivor regions from the previous garbage collection. The live objects from the eden and survivor regions are copied, or evacuated, to a new set of regions. The destination region for a particular object depends upon the object’s age; an object that has aged sufficiently evacuates to an old generation region (that is, promoted); otherwise, the object evacuates to a survivor region and will be included in the CSet of the next young or mixed garbage collection.</p>
<ul>
<li><strong>G1满足大部分从一个区域添加到年轻代集合区域的内存申请，在年轻代回收期间，G1收集器会同时收集eden区域的垃圾和survivor区域的垃圾从上一个垃圾集中。 eden区和survivor区存活的对象已经被拷贝了，或者已经被撤离出当前区域到了一个的区域集。复制的目标区域是特定的，取决于对象的年龄来决定复制到哪个区块； 一个对象有足够的年龄撤离出eden与survivor到老年区域（这一步是晋升）； 另外，如果这个对象撤离到survivor 区 对象的引用会被包含到下一个young 或者 mixed 垃圾集的 cset 中.（CSET标记存活）</strong></li>
</ul>
<h4 id="Mixed-Garbage-Collections-（混合垃圾收集）"><a href="#Mixed-Garbage-Collections-（混合垃圾收集）" class="headerlink" title="Mixed Garbage Collections （混合垃圾收集）"></a>Mixed Garbage Collections （混合垃圾收集）</h4><p>Upon successful completion of a concurrent marking cycle, the G1 GC switches from performing young garbage collections to performing mixed garbage collections. In a mixed garbage collection, the G1 GC optionally adds some old regions to the set of eden and survivor regions that will be collected. The exact number of old regions added is controlled by a number of flags that will be discussed later (see “<a target="_blank" rel="noopener" href="https://www.oracle.com/technical-resources/articles/java/g1gc.html#Taming">Taming Mixed GCs</a>“). After the G1 GC collects a sufficient number of old regions (over multiple mixed garbage collections), G1 reverts to performing young garbage collections until the next marking cycle completes.</p>
<ul>
<li><strong>在成功完成并发标记周期的基础上，G1 从 执行年轻代垃圾收集切换到执行混合垃圾收集。在混合的垃圾收集模式中，G1选择性的添加一些老年代区块到已经被收集了的young和survivor的区块中.  一个标志数字控多少准确个老年代会被添加到已经被清空的新区块中；在G1 收集了足够多的old区块（在多个混合的垃圾集合中），G1 会切换执行young代的垃圾收集直到下一个标记周期完成.</strong></li>
</ul>
<ul>
<li><p><strong>核心算法实现</strong></p>
<ul>
<li><p><strong>Rset (Remember Set) 引用记忆集</strong></p>
<ul>
<li><p><strong>The G1 GC uses independent Remembered Sets (RSets) to track references into regions. Independent RSets enable parallel and independent collection of regions because only a region’s RSet must be scanned for references into that region, instead of the whole heap. The G1 GC uses a post-write barrier to record changes to the heap and update the RSets.</strong></p>
</li>
<li><p><strong>G1垃圾回收器使用独立的记忆集来追踪区域里的引用，独立的RSET允许并行，并且 每个区域的RSET是独立的，因为只有当前区域的RSET为了扫描引用才必须进入当前区域，从而避免全堆扫描。垃圾回收器利用后置写屏障来标记记录堆更改和RSET的更新.</strong></p>
</li>
</ul>
</li>
<li><p><strong>Cset（Collection Set）存活收集集</strong></p>
<ul>
<li><strong>The G1 GC reduces heap fragmentation by incremental parallel copying of live objects from one or more sets of regions (called Collection Set (CSet)) into different new region(s) to achieve compaction.</strong></li>
</ul>
<ul>
<li><strong>垃圾收集器为了减少堆内存碎片,将一组或多组区域的存活对象并行复制到不同的新区域来实现内存整理压缩.</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Important-Defaults-（官方文档）"><a href="#Important-Defaults-（官方文档）" class="headerlink" title="Important Defaults （官方文档）"></a>Important Defaults （官方文档）</h4><p>The G1 GC is an adaptive garbage collector with defaults that enable it to work efficiently without modification. Here is a list of important options and their default values. This list applies to the latest Java HotSpot VM, build 24. You can adapt and tune the G1 GC to your application performance needs by entering the following options with changed settings on the JVM command line.</p>
<ul>
<li><p>```<br>-XX:G1HeapRegionSize=n</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  Sets the size of a G1 region. The value will be a power of two and can range from 1MB to 32MB. The goal is to have around 2048 regions based on the minimum Java heap size.</span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  -XX:MaxGCPauseMillis=200</span><br></pre></td></tr></table></figure>

<p>Sets a target value for desired maximum pause time. The default value is 200 milliseconds. The specified value does not adapt to your heap size.</p>
</li>
<li><p>```<br>-XX:G1NewSizePercent=5</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  Sets the percentage of the heap to use as the minimum for the young generation size. The default value is 5 percent of your Java heap. This is an experimental flag. See &quot;[How to unlock experimental VM flags](https://www.oracle.com/technical-resources/articles/java/g1gc.html#Unlock)&quot; for an example. This setting replaces the `-XX:DefaultMinNewGenPercent` setting. This setting is not available in Java HotSpot VM, build 23.</span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  -XX:G1MaxNewSizePercent=60</span><br></pre></td></tr></table></figure>

<p>Sets the percentage of the heap size to use as the maximum for young generation size. The default value is 60 percent of your Java heap. This is an experimental flag. See “<a target="_blank" rel="noopener" href="https://www.oracle.com/technical-resources/articles/java/g1gc.html#Unlock">How to unlock experimental VM flags</a>“ for an example. This setting replaces the <code>-XX:DefaultMaxNewGenPercent</code> setting. This setting is not available in Java HotSpot VM, build 23.</p>
</li>
<li><p>```<br>-XX:ParallelGCThreads=n</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  Sets the value of the STW worker threads. Sets the value of n to the number of logical processors. The value of `n` is the same as the number of logical processors up to a value of 8.</span><br><span class="line"></span><br><span class="line">  If there are more than eight logical processors, sets the value of `n` to approximately 5/8 of the logical processors. This works in most cases except for larger SPARC systems where the value of `n` can be approximately 5/16 of the logical processors.</span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  -XX:ConcGCThreads=n</span><br></pre></td></tr></table></figure>

<p>Sets the number of parallel marking threads. Sets <code>n</code> to approximately 1/4 of the number of parallel garbage collection threads (<code>ParallelGCThreads</code>).</p>
</li>
<li><p>```<br>-XX:InitiatingHeapOccupancyPercent=45</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  Sets the Java heap occupancy threshold that triggers a marking cycle. The default occupancy is 45 percent of the entire Java heap.</span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  -XX:G1MixedGCLiveThresholdPercent=65</span><br></pre></td></tr></table></figure>

<p>Sets the occupancy threshold for an old region to be included in a mixed garbage collection cycle. The default occupancy is 65 percent. This is an experimental flag. See “<a target="_blank" rel="noopener" href="https://www.oracle.com/technical-resources/articles/java/g1gc.html#Unlock">How to unlock experimental VM flags</a>“ for an example. This setting replaces the <code>-XX:G1OldCSetRegionLiveThresholdPercent</code> setting. This setting is not available in Java HotSpot VM, build 23.</p>
</li>
<li><p>```<br>-XX:G1HeapWastePercent=10</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  Sets the percentage of heap that you are willing to waste. The Java HotSpot VM does not initiate the mixed garbage collection cycle when the reclaimable percentage is less than the heap waste percentage. The default is 10 percent. This setting is not available in Java HotSpot VM, build 23.</span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  -XX:G1MixedGCCountTarget=8</span><br></pre></td></tr></table></figure>

<p>Sets the target number of mixed garbage collections after a marking cycle to collect old regions with at most <code>G1MixedGCLIveThresholdPercent</code> live data. The default is 8 mixed garbage collections. The goal for mixed collections is to be within this target number. This setting is not available in Java HotSpot VM, build 23.</p>
</li>
<li><p>```<br>-XX:G1OldCSetRegionThresholdPercent=10</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  Sets an upper limit on the number of old regions to be collected during a mixed garbage collection cycle. The default is 10 percent of the Java heap. This setting is not available in Java HotSpot VM, build 23.</span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  -XX:G1ReservePercent=10</span><br></pre></td></tr></table></figure>

<p>Sets the percentage of reserve memory to keep free so as to reduce the risk of to-space overflows. The default is 10 percent. When you increase or decrease the percentage, make sure to adjust the total Java heap by the same amount. This setting is not available in Java HotSpot VM, build 23.</p>
</li>
</ul>
<h4 id="How-to-Unlock-Experimental-VM-Flags"><a href="#How-to-Unlock-Experimental-VM-Flags" class="headerlink" title="How to Unlock Experimental VM Flags"></a>How to Unlock Experimental VM Flags</h4><p>To change the value of experimental flags, you must unlock them first. You can do this by setting <code>-XX:+UnlockExperimentalVMOptions</code> explicitly on the command line before any experimental flags. For example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; java -XX:+UnlockExperimentalVMOptions -XX:G1NewSizePercent=10 -XX:G1MaxNewSizePercent=75 G1test.jar</span><br></pre></td></tr></table></figure>

<h4 id="Recommendations"><a href="#Recommendations" class="headerlink" title="Recommendations"></a>Recommendations</h4><p>When you evaluate and fine-tune G1 GC, keep the following recommendations in mind:</p>
<ul>
<li><p><strong>Young Generation Size</strong>: Avoid explicitly setting young generation size with the <code>-Xmn</code> option or any or other related option such as <code>-XX:NewRatio</code>. Fixing the size of the young generation overrides the target pause-time goal.</p>
</li>
<li><p><strong>Pause Time Goals</strong>: When you evaluate or tune any garbage collection, there is always a latency versus throughput trade-off. The G1 GC is an incremental garbage collector with uniform pauses, but also more overhead on the application threads. The throughput goal for the G1 GC is 90 percent application time and 10 percent garbage collection time. When you compare this to Java HotSpot VM’s throughput collector, the goal there is 99 percent application time and 1 percent garbage collection time. Therefore, when you evaluate the G1 GC for throughput, relax your pause-time target. Setting too aggressive a goal indicates that you are willing to bear an increase in garbage collection overhead, which has a direct impact on throughput. When you evaluate the G1 GC for latency, you set your desired (soft) real-time goal, and the G1 GC will try to meet it. As a side effect, throughput may suffer.</p>
</li>
<li><p>Taming Mixed Garbage Collections</p>
<p>: Experiment with the following options when you tune mixed garbage collections. See “</p>
<p>Important Defaults</p>
<p>“ for information about these options:</p>
<ul>
<li><code>-XX:InitiatingHeapOccupancyPercent</code><br>For changing the marking threshold.</li>
<li><code>-XX:G1MixedGCLiveThresholdPercent</code> and <code>-XX:G1HeapWastePercent</code><br>When you want to change the mixed garbage collections decisions.</li>
<li><code>-XX:G1MixedGCCountTarget</code> and <code>-XX:G1OldCSetRegionThresholdPercent</code><br>When you want to adjust the CSet for old regions.</li>
</ul>
</li>
</ul>
<h4 id="Overflow-and-Exhausted-Log-Messages"><a href="#Overflow-and-Exhausted-Log-Messages" class="headerlink" title="Overflow and Exhausted Log Messages"></a>Overflow and Exhausted Log Messages</h4><p>When you see to-space overflow/exhausted messages in your logs, the G1 GC does not have enough memory for either survivor or promoted objects, or for both. The Java heap cannot expand since it is already at its max. Example messages:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">924.897: [GC pause (G1 Evacuation Pause) (mixed) (to-space exhausted), 0.1957310 secs]</span><br></pre></td></tr></table></figure>

<p>OR</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">924.897: [GC pause (G1 Evacuation Pause) (mixed) (to-space overflow), 0.1957310 secs]</span><br></pre></td></tr></table></figure>

<p>To alleviate the problem, try the following adjustments:</p>
<p>Increase the value of the <code>-XX:G1ReservePercent</code> option (and the total heap accordingly) to increase the amount of reserve memory for “to-space”.</p>
<p>Start the marking cycle earlier by reducing the <code>-XX:InitiatingHeapOccupancyPercent</code>.</p>
<p>You can also increase the value of the <code>-XX:ConcGCThreads</code> option to increase the number of parallel marking threads.</p>
<p>See “<a target="_blank" rel="noopener" href="https://www.oracle.com/technical-resources/articles/java/g1gc.html#Imp">Important Defaults</a>“ for a description of these options.</p>
<h4 id="Humongous-Objects-and-Humongous-Allocations"><a href="#Humongous-Objects-and-Humongous-Allocations" class="headerlink" title="Humongous Objects and Humongous Allocations"></a>Humongous Objects and Humongous Allocations</h4><p>For G1 GC, any object that is more than half a region size is considered a “Humongous object”. Such an object is allocated directly in the old generation into “Humongous regions”. These Humongous regions are a contiguous set of regions. <code>StartsHumongous</code> marks the start of the contiguous set and <code>ContinuesHumongous</code> marks the continuation of the set.</p>
<p>Before allocating any Humongous region, the marking threshold is checked, initiating a concurrent cycle, if necessary.</p>
<p>Dead Humongous objects are freed at the end of the marking cycle during the cleanup phase also during a full garbage collection cycle.</p>
<p>In-order to reduce copying overhead, the Humongous objects are not included in any evacuation pause. A full garbage collection cycle compacts Humongous objects in place.</p>
<p>Since each individual set of StartsHumongous and ContinuesHumongous regions contains just one humongous object, the space between the end of the humongous object and the end of the last region spanned by the object is unused. For objects that are just slightly larger than a multiple of the heap region size, this unused space can cause the heap to become fragmented.</p>
<p>If you see back-to-back concurrent cycles initiated due to Humongous allocations and if such allocations are fragmenting your old generation, please increase your <code>-XX:G1HeapRegionSize</code> such that previous Humongous objects are no longer Humongous and will follow the regular allocation path.</p>
<h4 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h4><p>G1 GC is a regionalized, parallel-concurrent, incremental garbage collector that provides more predictable pauses compared to other HotSpot GCs. The incremental nature lets G1 GC work with larger heaps and still provide reasonable worst-case response times. The adaptive nature of G1 GC just needs a maximum soft-real time pause-time goal along-with the desired maximum and minimum size for the Java heap on the JVM command line.</p>
<h4 id="See-Also"><a href="#See-Also" class="headerlink" title="See Also"></a>See Also</h4><ul>
<li><a target="_blank" rel="noopener" href="https://www.oracle.com/java/technologies/javase/hotspot-garbage-collection.html">The Garbage-First Garbage Collector</a></li>
<li><a target="_blank" rel="noopener" href="https://www.oracle.com/java/technologies/javase/javase-core-technologies-apis.html">Java HotSpot Garbage Collection</a></li>
</ul>
<h4 id="About-the-Author"><a href="#About-the-Author" class="headerlink" title="About the Author"></a>About the Author</h4><p>Monica Beckwith, Principal Member of Technical Staff at Oracle, is the performance lead for the Java HotSpot VM’s Garbage First Garbage Collector. She has worked in the performance and architecture industry for over 10 years. Prior to Oracle and Sun Microsystems, Monica lead the performance effort at Spansion Inc. Monica has worked with many industry standard Java based benchmarks with a constant goal of finding opportunities for improvement in the Java HotSpot VM.</p>
<h3 id="王者ZGC"><a href="#王者ZGC" class="headerlink" title="王者ZGC"></a>王者ZGC</h3><ul>
<li><p><strong>回收过程</strong></p>
<ul>
<li><p><strong>初始标记 STW</strong></p>
</li>
<li><p><strong>并发标记</strong></p>
</li>
<li><p><strong>并发转移STW</strong></p>
</li>
</ul>
</li>
<li><p><strong>核心算法</strong></p>
<ul>
<li><p><strong>标记对象指针</strong></p>
<ul>
<li><strong>暂时可以理解为在64位内存地址中取三个标志位映射对象的同一块物理内存地址，标记对象的标记过程，重新定位过程，等GC回收标志</strong></li>
</ul>
</li>
<li><p><strong>合理利用64位处理器架构 ，Numa架构</strong></p>
<ul>
<li><strong>现在多CPU插槽的服务器都是Numa架构，比如两颗CPU插槽(24核)，64G内存的服务器，那其中一颗CPU上的12个核，访问从属于它的32G本地内存，要比访问另外32G远端内存要快得多。</strong></li>
</ul>
</li>
<li><p><strong>读屏障</strong></p>
<ul>
<li>因为在标记和移动过程中，GC线程和应用线程是并发执行的，所以存在这种情况：对象A内部的引用所指的对象B在标记或者移动状态，为了保证应用线程拿到的B对象是对的，那么在读取B的指针时会经过一个 “load barriers” 读屏障，这个屏障可以保证在执行GC时，数据读取的正确性。</li>
</ul>
</li>
<li><p><strong>Compacting 内存页压缩</strong></p>
</li>
</ul>
</li>
</ul>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://www.010101.cc/2021/11/11/JVM%E4%B9%8BGC%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E5%88%86%E6%9E%90/" title="JVM之GC垃圾回收器浅析" target="_blank" rel="external">http://www.010101.cc/2021/11/11/JVM之GC垃圾回收器分析/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/with021" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/with021" target="_blank"><span class="text-dark">010101 Decimal is 21, so call me 021(zero to one)</span><small class="ml-1x">Web Developer</small></a></h3>
        <div>记录点滴生活。</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/11/11/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84Btree%E4%B9%8BMysql%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B/" title="数据结构Btree之Mysql自顶向下"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;Newer</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2021/11/11/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84RingBuffer%E4%B9%8B%E6%9C%BA%E6%A2%B0%E4%B9%8B%E7%BE%8E---TODO/" title="数据结构RingBuffer之机械之美---TODO"><span>Older&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="Catalogue" role="button">
        <span>[&nbsp;</span><span>Catalogue</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>$</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,wechat,qq"></div>
    
  </div>
  </div>
</nav>
  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>Maybe you could buy me a cup of coffee.</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipay.png" alt="Scan Qrcode" title="Scan" />
              </div>
              <p class="text-muted mv">Scan this qrcode</p>
              <p class="text-grey">Open alipay app scan this qrcode, buy me a coffee!</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/wechat.png" alt="Scan Qrcode" title="Scan" />
              </div>
              <p class="text-muted mv">Scan this qrcode</p>
              <p class="text-grey">Open wechat app scan this qrcode, buy me a coffee!</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> alipay</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> wechat payment</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/with021" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://weibo.com/with021" target="_blank" title="Weibo" data-toggle=tooltip data-placement=top><i class="icon icon-weibo"></i></a></li>
        
        <li><a href="https://twitter.com/with021" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
        	        	© 2021 021 All rights reserved. <a href="https://github.com/with021" target="_blank"> 
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





   
    
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine"></script>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#vcomments',
    verify: false,
    notify: false,
    appId: 'KrdghyjYV8lbuzvwWV6Hv7p8-gzGzoHsz',
    appKey: 'Nl2ozIoQVlJ3uK5V7JG7fUMo',
    placeholder: '来了，老弟，说点啥，say something before you go away...',
    avatar: 'mm',
    meta: meta,
    pageSize: '10' || 10,
    visitor: false
  });
  </script>

     







</body>
</html>